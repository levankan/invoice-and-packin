{% load static %}
{% load custom_tags %}

<style>
@page {
    size: A4;
    margin: 10mm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
        font-size: 11px;
        color: black;
    }
}
</style>

<div style="max-width: 1100px; margin: auto; min-height: 100vh; font-family: Arial, sans-serif; font-size: 13px; padding: 20px;">

    <!-- Header -->
    <table style="width: 100%; margin-bottom: 40px;">
        <tr>
            <td style="width: 50%; vertical-align: middle;">
                <img src="{% static 'img/atc_logo.jpeg' %}" 
                     alt="ATC Logo" 
                     style="max-height: 140px; width: auto; display: block;">
            </td>
            <td style="width: 50%; vertical-align: middle; text-align: right;">
                <h2 style="margin: 0; font-size: 20px;">INVOICE</h2>
                <p style="margin: 4px 0;">
                    <strong>No:</strong> {{ export.invoice_number }}
                    {% if pallet %} / {{ pallet.pallet_number }}{% endif %}
                </p>                
                <p><strong>Date:</strong> {{ export.created_at|date:"d/m/Y" }}</p>
                <p><strong>Project No:</strong> {{ export.project_no }}</p>
                <p><strong>Export No:</strong> {{ export.export_number }}</p>
                <p><strong>Packing List No:</strong> {{ export.packing_list_number }}</p>
            </td>
        </tr>
    </table>

    <!-- Parties -->
    <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; margin-bottom: 25px;">
        <tr>
            <td style="width: 33%; border: 1px solid #000; padding: 10px;">
                <strong>Seller:</strong><br>
                {{ export.seller }}<br>
                ID: 404496121<br>
                Mikheil Grigorashvili 27, 0198, Samgori District,<br>
                Tbilisi, Georgia<br>
                Country of Origin: Georgia
            </td>
            <td style="width: 33%; border: 1px solid #000; padding: 10px;">
                <strong>Sold To:</strong><br>
                {{ export.sold_to }}<br><br>
                <strong>Incoterms 2010:</strong> EXW Tbilisi<br>
                <strong>Terms of Payment:</strong> 15D
            </td>
            <td style="width: 34%; border: 1px solid #000; padding: 10px;">
                <strong>Shipped To:</strong><br>
                {{ export.shipped_to }}
            </td>
        </tr>
    </table>

    <!-- Invoice Items -->
    <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; text-align: center;">
        <thead style="background: #f2f2f2;">
            <tr>
                <th style="border: 1px solid #000; padding: 8px;">#</th>
                <th style="border: 1px solid #000; padding: 8px;">Customer PO</th>
                <th style="border: 1px solid #000; padding: 8px;">PO Line</th>
                <th style="border: 1px solid #000; padding: 8px;">PN</th>
                <th style="border: 1px solid #000; padding: 8px; text-align: left;">Description</th>
                <th style="border: 1px solid #000; padding: 8px;">Price (USD)</th>
                <th style="border: 1px solid #000; padding: 8px;">Qty Total</th>
                <th style="border: 1px solid #000; padding: 8px;">Total (USD)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in grouped_items %}
            <tr>
                <td style="border: 1px solid #000; padding: 6px;">{{ forloop.counter }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ item.customer_po }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ item.po_line }}</td>
                <td style="border: 1px solid #000; padding: 6px; white-space: nowrap;">{{ item.cross_reference }}</td>
                <td style="border: 1px solid #000; padding: 6px; text-align: left;">{{ item.description }}</td>
                <td style="border: 1px solid #000; padding: 6px; text-align: right;">{{ item.price|floatformat:2 }}</td>
                <td style="border: 1px solid #000; padding: 6px; text-align: right;">{{ item.total_qty }}</td>
                <td style="border: 1px solid #000; padding: 6px; text-align: right;">{{ item.total_value|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" style="border: 1px solid #000; padding: 8px; text-align: center;">No items</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="background: #f9f9f9; font-weight: bold;">
                <td colspan="6" style="border: 1px solid #000; padding: 8px; text-align: right;">GRAND TOTAL</td>
                <td style="border: 1px solid #000; padding: 8px; text-align: right;">{{ grand_total_qty }}</td>
                <td style="border: 1px solid #000; padding: 8px; text-align: right;">{{ grand_total_value|floatformat:2 }}</td>
            </tr>
        </tfoot>
    </table>

    <!-- Notes + Signature -->
    <table style="width: 100%; margin-top: 30px;">
        <tr>
            <td style="width: 60%; vertical-align: top;">
                <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; margin-bottom: 20px;">
                    <tr>
                        <td style="padding: 10px;">
                            <strong>Notes:</strong><br>
                            Civil Aviation Parts For Boeing 787; HS Code: 8807 30 000 01<br>
                            Gross Weight: {{ export.total_gross_weight|floatformat:2|default:"___" }} KG
                        </td>
                    </tr>
                </table>

                <p><strong>Authorized Signature: _____________________</strong></p>

                <p style="margin-top: 20px;">
                    <strong>Payment should be affected to:</strong><br>
                    ATC - Aero-Structure Technologies Cyclone JSC, ID: 404496121<br>
                    Bank of Georgia, SWIFT: BAGAGE22, Account: GE92BG0000000553967900
                </p>
            </td>
            <td style="width: 40%;"></td>
        </tr>
    </table>
</div>
