{% load static %}
{% load custom_tags %}

<style>
@page {
    size: A4;
    margin: 10mm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
        font-size: 11px;
        color: black;
    }
}
</style>

<div style="max-width: 1100px; margin: auto; font-family: Arial, sans-serif; font-size: 13px; padding: 20px;">

    <!-- Header -->
    <table style="width: 100%; margin-bottom: 30px;">
        <tr>
            <td style="width: 50%; vertical-align: middle;">
                <img src="{% static 'img/atc_logo.jpeg' %}" 
                     alt="ATC Logo" 
                     style="max-height: 120px; width: auto; display: block;">
            </td>
            <td style="width: 50%; vertical-align: middle; text-align: right;">
                <h2 style="margin: 0; font-size: 20px;">PACKING LIST</h2>
                <p style="margin: 4px 0;">
                    <strong>No:</strong> {{ export.packing_list_number }}
                    {% if pallet %} / {{ pallet.pallet_number }}{% endif %}
                </p>                
                <p><strong>Date:</strong> {{ export.created_at|date:"d/m/Y" }}</p>
                <p><strong>Export No:</strong> {{ export.export_number }}</p>
                <p>
                    <strong>Invoice No:</strong> {{ export.invoice_number }}
                    {% if pallet %} / {{ pallet.pallet_number }}{% endif %}
                </p>                
            </td>
        </tr>
    </table>

    <!-- Seller & Shipped To -->
    <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; margin-bottom: 25px;">
        <tr>
            <td style="width: 33%; border: 1px solid #000; padding: 10px; vertical-align: top;">
                <strong>Ship from:</strong><br>
                {{ export.seller }}<br>
                ID: 404496121<br>
                Mikheil Grigorashvili 27, 0198, Samgori District,<br>
                Tbilisi, Georgia<br>
                Country of Origin: Georgia
            </td>
            <td style="width: 33%; border: 1px solid #000; padding: 10px; vertical-align: top;">
                <strong>Sold To:</strong><br>
                Elbit Systems Cyclone<br>
                ID: 520033374<br>
                Industrial Park Bar-Lev, P.O.B 114,<br>
                Karmiel, Israel
            </td>
            <td style="width: 34%; border: 1px solid #000; padding: 10px; vertical-align: top; text-align: left;">
                <strong>Ship To:</strong><br>
                <p style="margin:0; font-family: Arial, sans-serif; font-size: 13px; 
                          white-space: pre-wrap; line-height: 1.4; text-align: left;">
                    {{ export.shipped_to }}
                </p>
            </td>            
        </tr>
    </table>
    

    <!-- Items -->
    <h3 style="margin-bottom: 10px;">Items</h3>
    <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; text-align: center;">
        <thead style="background: #f2f2f2;">
            <tr>
                <th style="border: 1px solid #000; padding: 8px;">Line</th>
                <th style="border: 1px solid #000; padding: 8px;">Box No</th>
                <th style="border: 1px solid #000; padding: 8px;">Customer PO</th>
                <th style="border: 1px solid #000; padding: 8px;">PO Line</th>
                <th style="border: 1px solid #000; padding: 8px;">PN</th>
                <th style="border: 1px solid #000; padding: 8px; text-align: left;">Description</th>
                <th style="border: 1px solid #000; padding: 8px;">Qty</th>
                <th style="border: 1px solid #000; padding: 8px;">Pallet No</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td style="border: 1px solid #000; padding: 6px;">{{ forloop.counter }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ item.box_number }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ item.customer_po }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ item.po_line }}</td>
                <td style="border: 1px solid #000; padding: 6px; white-space: nowrap;">{{ item.cross_reference }}</td>
                <td style="border: 1px solid #000; padding: 6px; text-align: left;">{{ item.description }}</td>
                <td style="border: 1px solid #000; padding: 6px; text-align: right;">{{ item.total_qty }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ item.pallet_number }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="8">No items</td></tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="background: #f9f9f9; font-weight: bold;">
                <td colspan="6" style="border: 1px solid #000; padding: 8px; text-align: right;">
                    TOTAL QUANTITY
                </td>
                <td style="border: 1px solid #000; padding: 8px; text-align: right;">
                    {{ grand_total_qty }}
                </td>
                <td style="border: 1px solid #000; padding: 8px;"></td>
            </tr>
        </tfoot>        
    </table>

    <!-- Pallet Summary -->
    <h3 style="margin-top: 30px; margin-bottom: 10px;">Pallet Summary</h3>
    <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; text-align: center;">
        <thead style="background: #f2f2f2;">
            <tr>
                <th style="border: 1px solid #000; padding: 8px;">Pallet #</th>
                <th style="border: 1px solid #000; padding: 8px;">Length (Cm)</th>
                <th style="border: 1px solid #000; padding: 8px;">Width (Cm)</th>
                <th style="border: 1px solid #000; padding: 8px;">Height (Cm)</th>
                <th style="border: 1px solid #000; padding: 8px;">Gross Weight (Kg)</th>
            </tr>
        </thead>
        <tbody>
            {% for pallet in pallets %}
            <tr>
                <td style="border: 1px solid #000; padding: 6px;">{{ pallet.pallet_number }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ pallet.length_cm }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ pallet.width_cm }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ pallet.height_cm }}</td>
                <td style="border: 1px solid #000; padding: 6px;">{{ pallet.gross_weight_kg }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No pallet data</td></tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="background: #f9f9f9;">
                <td colspan="4" style="border: 1px solid #000; padding: 8px; text-align: right;">
                    <strong>Total Gross Weight</strong>
                </td>
                <td style="border: 1px solid #000; padding: 8px; font-weight: bold;">
                    {{ total_gross_weight }}
                </td>
            </tr>
        </tfoot>
    </table>

</div>
